"use strict";
(("undefined" != typeof self ? self : this).webpackJsonp__wix_pro_gallery_tpa = ("undefined" != typeof self ? self : this).webpackJsonp__wix_pro_gallery_tpa || []).push([
    [658], {
        6228: (e, t, o) => {
            o.r(t), o.d(t, {
                default: () => f,
                itemActions: () => m
            });
            var r = o(2712),
                n = o(7607),
                i = o.n(n),
                s = o(4175),
                a = o(408),
                c = o(1859),
                l = o(2125),
                p = o(140),
                h = "love",
                u = "love",
                d = "loveCountFromStats",
                v = function() {
                    function e() {
                        this.getEncodedContextToken = this.getEncodedContextToken.bind(this), this.parseReactionServiceResponse = this.parseReactionServiceResponse.bind(this), this.newParseReactionServiceResponse = this.newParseReactionServiceResponse.bind(this)
                    }
                    return e.prototype.getItemsLoveData = function(e, t, o, n, i) {
                        return (0, r.mG)(this, void 0, void 0, (function() {
                            var a, c, l, p, h, u, d;
                            return (0, r.Jh)(this, (function(r) {
                                switch (r.label) {
                                    case 0:
                                        a = this.getEncodedContextToken(n, i), c = e.map((function(e) {
                                            return e.itemId
                                        })), l = c.join("&resourceIds="), p = "".concat(o, "/_api/reactions-server/v1/reactions?contextToken=").concat(a, "&resourceIds=").concat(l), r.label = 1;
                                    case 1:
                                        return r.trys.push([1, 6, , 7]), [4, fetch(p, {
                                            method: "GET",
                                            headers: {
                                                "Content-Type": "application/json",
                                                Authorization: t
                                            }
                                        })];
                                    case 2:
                                        return 200 !== (h = r.sent()).status ? [3, 4] : [4, h.json()];
                                    case 3:
                                        return u = r.sent().responses, void 0, [2, this.shouldUseNewParsing() ? this.newParseReactionServiceResponse(u) : this.parseReactionServiceResponse(u)];
                                    case 4:
                                        return s.G.isVerbose() && console.error("Reaction-Service error - GET call response status: ".concat(h.status)), [2, {
                                            error: "Reaction-Service error - GET call response status: ".concat(h.status)
                                        }];
                                    case 5:
                                        return [3, 7];
                                    case 6:
                                        return d = r.sent(), s.G.isVerbose() && console.error("Reaction-Service error - some error when requesting data from reaction-service: ".concat(d.message)), [2, {
                                            error: "Reaction-Service error - some error when requesting data from reaction-service: ".concat(d.message)
                                        }];
                                    case 7:
                                        return [2]
                                }
                            }))
                        }))
                    }, e.prototype.toggleItemLove = function(e, t, o, n, i, a) {
                        return (0, r.mG)(this, void 0, void 0, (function() {
                            var c, l, p, h, d, v;
                            return (0, r.Jh)(this, (function(r) {
                                switch (r.label) {
                                    case 0:
                                        c = this.getEncodedContextToken(i, a), l = u, p = "".concat(n, "/_api/reactions-server/v1/reactions/").concat(e, "/").concat(l, "?contextToken=").concat(c), r.label = 1;
                                    case 1:
                                        return r.trys.push([1, 5, , 6]), [4, fetch(p, {
                                            method: t,
                                            headers: {
                                                "Content-Type": "application/json",
                                                Authorization: o
                                            }
                                        })];
                                    case 2:
                                        return 200 !== (h = r.sent()).status ? [3, 4] : [4, h.json()];
                                    case 3:
                                        d = r.sent(), s.G.isVerbose() && console.log("Succeeded ".concat(t, " action of Reactions service for item ").concat(e, ". response: ").concat(d)), r.label = 4;
                                    case 4:
                                        return [3, 6];
                                    case 5:
                                        return v = r.sent(), s.G.isVerbose() && console.error("Failed ".concat(t, " action of Reactions service for item ").concat(e, ". ").concat(v)), [2, {
                                            responses: "some error when requesting from reactions service" + p + v.message
                                        }];
                                    case 6:
                                        return [2]
                                }
                            }))
                        }))
                    }, e.prototype.mergeDataFromStatsToReactionService = function(e, t, o, n, i, a) {
                        return (0, r.mG)(this, void 0, void 0, (function() {
                            var c, l, p, h, u, v;
                            return (0, r.Jh)(this, (function(r) {
                                switch (r.label) {
                                    case 0:
                                        c = this.getEncodedContextToken(i, a), l = "".concat(n, "/_api/reactions-server/v1/reactions/").concat(e, "/add-reaction?contextToken=").concat(c), r.label = 1;
                                    case 1:
                                        return r.trys.push([1, 7, , 8]), [4, fetch(l, {
                                            method: "POST",
                                            headers: {
                                                "Content-Type": "application/json",
                                                Authorization: o
                                            },
                                            body: JSON.stringify({
                                                reaction: {
                                                    reactionCode: d,
                                                    reactionParams: {
                                                        count: String(t)
                                                    }
                                                }
                                            })
                                        })];
                                    case 2:
                                        return 200 !== (p = r.sent()).status ? [3, 4] : [4, p.json()];
                                    case 3:
                                        return h = r.sent(), s.G.isVerbose() && console.log("Succeeded to POST old love counts from stats to Reactions service for item ".concat(e, ". response: ").concat(h)), [2, {
                                            status: p.status,
                                            message: "success"
                                        }];
                                    case 4:
                                        return [4, p.json()];
                                    case 5:
                                        return u = r.sent().message, [2, {
                                            status: p.status,
                                            message: u
                                        }];
                                    case 6:
                                        return [3, 8];
                                    case 7:
                                        return v = r.sent(), s.G.isVerbose() && console.error("Failed to POST old love counts from stats to Reactions service for item ".concat(e, ". ").concat(v)), [2, {
                                            responses: "some error when requesting from reactions service" + l + v.message
                                        }];
                                    case 8:
                                        return [2]
                                }
                            }))
                        }))
                    }, e.prototype.isLovedByCurrentVisitor = function(e, t, o) {
                        var r, n;
                        try {
                            if (o) {
                                var i = null === (n = null === (r = o[e]) || void 0 === r ? void 0 : r.identityReactions) || void 0 === n ? void 0 : n.reactions;
                                return (null == i ? void 0 : i.findIndex((function(e) {
                                    return e.identity.identityId === t && e.reaction.reactionCode === u
                                }))) > -1
                            }
                        } catch (e) {
                            console.warn("isLovedByCurrentVisitor failed", e)
                        }
                    }, e.prototype.parseReactionServiceResponse = function(e) {
                        var t;
                        try {
                            for (var o = {}, r = function(e, r) {
                                    o[e] = 0;
                                    var n = null === (t = r.identityReactions) || void 0 === t ? void 0 : t.reactions,
                                        i = !1;
                                    n.forEach((function(t) {
                                        var r, n, s;
                                        switch (null === (r = t.reaction) || void 0 === r ? void 0 : r.reactionCode) {
                                            case d:
                                                i || (o[e] += Number(null === (s = null === (n = t.reaction) || void 0 === n ? void 0 : n.reactionParams) || void 0 === s ? void 0 : s.count), i = !0);
                                                break;
                                            case u:
                                                o[e] += 1
                                        }
                                    }))
                                }, n = 0, i = Object.entries(e); n < i.length; n++) {
                                var a = i[n];
                                r(a[0], a[1])
                            }
                            return o
                        } catch (e) {
                            return s.G.isVerbose() && console.error("Reaction-Service error - problem with parsing response: ".concat(e.message)), {
                                error: "Reaction-Service error - problem with parsing response: ".concat(e.message)
                            }
                        }
                    }, e.prototype.newParseReactionServiceResponse = function(e) {
                        var t, o, r, n;
                        try {
                            for (var i = {}, a = 0, c = Object.entries(e); a < c.length; a++) {
                                var l = c[a],
                                    p = l[0],
                                    h = l[1];
                                i[p] = 0;
                                var u = null === (t = h.identityReactions) || void 0 === t ? void 0 : t.reactions[0];
                                if (u) {
                                    if ((null === (o = u.reaction) || void 0 === o ? void 0 : o.reactionCode) === d) i[p] += Number(null === (n = null === (r = u.reaction) || void 0 === r ? void 0 : r.reactionParams) || void 0 === n ? void 0 : n.count);
                                    else i[p] += 1;
                                    i[p] += Math.max(0, h.total - 1)
                                } else i[p] += Math.max(0, h.total)
                            }
                            return i
                        } catch (e) {
                            return s.G.isVerbose() && console.error("Reaction-Service error - problem with new parsing response: ".concat(e.message)), {
                                error: "Reaction-Service error - problem with new parsing response: ".concat(e.message)
                            }
                        }
                    }, e.prototype.shouldUseReactionService = function() {
                        return !0
                    }, e.prototype.shouldUseNewParsing = function() {
                        return p.F.getExperimentBoolean("specs.pro-gallery.useNewReactionsCalculation") || p.F.getExperimentBoolean("specs.pro-gallery.useNewReactionsCalculation-Rollout")
                    }, e.prototype.getEncodedContextToken = function(e, t) {
                        var o = {
                            authorizerAppDefId: t,
                            contextId: e,
                            contextType: h
                        };
                        return encodeURIComponent(JSON.stringify(o))
                    }, e.prototype.sampleMigrationSuccessRate = function(e, t, o) {
                        var r;
                        try {
                            if (Object.keys(e).length > 0 && Object.keys(t).length > 0) {
                                var n = Object.keys(e).length,
                                    i = (r = n, Math.floor(Math.random() * Math.floor(r))),
                                    s = Object.keys(e)[i],
                                    a = e[s],
                                    c = t.hasOwnProperty(s) && t[s] || null;
                                t.hasOwnProperty(s) ? a <= c + 2 && a >= c - 2 ? "function" == typeof o && o("Reaction-Service Migration 3rd try - Sample is successful") : "function" == typeof o && o("Reaction-Service Migration 3rd try - Sample is failure") : "function" == typeof o && o("Reaction-Service Migration 3rd try - Item doesnt exist in stats response")
                            } else "function" == typeof o && o("Reaction-Service Migration 3rd try - reactionService and stats responses are empty")
                        } catch (e) {
                            "function" == typeof o && o("Reaction-Service Migration 3rd try - Error in sampleMigrationSuccessRate")
                        }
                    }, e
                }();
            var g = new v,
                y = function() {
                    function e() {
                        this.getLoveCount = this.getLoveCount.bind(this), this.wasInit = !1, this.loveCounts = {}, this.fetchSiteInfo(), this.isRemoveUseOfCounterApiEnabled = !0
                    }
                    return e.prototype.initWidgetData = function(e) {
                        if (this.config = e, e.instance && (this.instance = e.instance), e.items && (this.items = e.items), e.visitorId && (this.visitorId = e.visitorId), e.appDefinitionId && (this.appDefinitionId = e.appDefinitionId), e.sentryReport && (this.sentryReport = e.sentryReport), e.reportMigratedLoveDataBiEvent && (this.reportMigratedLoveDataBiEvent = e.reportMigratedLoveDataBiEvent), e.compId && (this.compId = e.compId), e.pageId && (this.pageId = e.pageId), e.styleId && (this.styleId = e.styleId), e.pageUrl && (this.pageUrl = e.pageUrl), "boolean" == typeof e.isStoreGallery && (this.isStoreGallery = e.isStoreGallery), "boolean" == typeof e.shouldUseGalleryIdForShareUrl && (this.shouldUseGalleryIdForShareUrl = e.shouldUseGalleryIdForShareUrl), e.galleryId && (this.galleryId = e.galleryId), e.viewMode && (this.viewMode = e.viewMode.toLowerCase()), e.fullscreenUrl) {
                            this.siteUrl = this.fullscreenUrl = this.normalizeFullscreenUrl(e.fullscreenUrl);
                            try {
                                this.siteUrl = this.fullscreenUrl.match(/.*\..*\//g)[0]
                            } catch (e) {}
                        }
                        return e.onLoveCountsFetched && (this.onLoveCountsFetched = e.onLoveCountsFetched), this.baseUrl = e.baseUrl || "//progallery.wixapps.net", e.reachLevel && this.setReachLevel(e.reachLevel), !s.G.isSSR() && "site" === this.viewMode && this.galleryId && "" !== this.galleryId && this.getStats(), this.wasInit = e, Date.now()
                    }, e.prototype.setItemsLoveData = function(e) {
                        var t = e.itemsLoveData;
                        if (t) {
                            this.reactionsServiceResponse = t;
                            var o = void 0;
                            o = g.shouldUseNewParsing() ? g.newParseReactionServiceResponse(t) : g.parseReactionServiceResponse(t), this.onLoveCountsFetched(o)
                        }
                    }, e.prototype.normalizeFullscreenUrl = function(e) {
                        var t = e;
                        return e && (t = e.split("?")[0]), t
                    }, e.prototype.fetchSiteInfo = function() {
                        var e, t = this;
                        try {
                            e = l.Z.location.href
                        } catch (t) {
                            e = ""
                        }
                        s.G.isInWix() ? (this.siteInfo = {}, a.Z.getSiteInfo((function(e) {
                            t.siteInfo = e
                        }))) : this.siteInfo = {
                            url: e,
                            baseUrl: e,
                            siteTitle: "Wix Pro Gallery",
                            siteDescription: "The best gallery any Wix user has ever seen!",
                            siteKeywords: "gallery,photos,photographer,professional"
                        }
                    }, e.prototype.getSiteUrl = function() {
                        return this.siteInfo.url
                    }, e.prototype.getStats = function() {
                        return (0, r.mG)(this, void 0, void 0, (function() {
                            var e = this;
                            return (0, r.Jh)(this, (function(t) {
                                switch (t.label) {
                                    case 0:
                                        return "site" !== this.viewMode || s.G.isDev() || s.G.isTest() ? [2] : !this.galleryId || "" === this.galleryId || this.galleryId.length < 10 ? (console.log("galleryId id", this.galleryId, typeof this.galleryId), console.error("get stats error - no galleryId"), [2]) : (fetch("".concat(this.baseUrl, "/_api/pro-gallery-webapp/v1/gallery/").concat(this.galleryId, "/stats/properties")).then((function(e) {
                                            return e.json()
                                        })).then((function(t) {
                                            try {
                                                t.properties ? e.statsProps = JSON.parse(t.properties) : t.statsToken && (e.statsProps = {
                                                    instance_id: e.config.instanceId,
                                                    set_id: e.galleryId
                                                }), e.statsToken = t.statsToken
                                            } catch (e) {
                                                console.error("Failed getting stats props", e)
                                            }
                                        })), [4, this.migrateLoveDataFromStatsToReactionService()]);
                                    case 1:
                                        return t.sent(), g.shouldUseReactionService() || this.getLoveDataWithOriginalFunction(), [2]
                                }
                            }))
                        }))
                    }, e.prototype.migrateLoveDataFromStatsToReactionService = function() {
                        return (0, r.mG)(this, void 0, void 0, (function() {
                            var e, t, o, n, i, a, c, l, p, h, u;
                            return (0, r.Jh)(this, (function(r) {
                                switch (r.label) {
                                    case 0:
                                        return r.trys.push([0, 8, , 9]), [4, g.getItemsLoveData(this.items, this.instance, this.baseUrl, this.galleryId, this.appDefinitionId)];
                                    case 1:
                                        return (e = r.sent()).hasOwnProperty("error") ? ("function" == typeof this.sentryReport && (u = e.error, this.sentryReport(u)), [2]) : this.isRemoveUseOfCounterApiEnabled ? [3, 3] : [4, this.getLoveDataUsingStatsApi()];
                                    case 2:
                                        t = r.sent(), g.sampleMigrationSuccessRate(e, t, this.sentryReport), r.label = 3;
                                    case 3:
                                        return 0 !== Object.keys(e).length || this.isRemoveUseOfCounterApiEnabled ? [3, 7] : [4, this.getLoveDataUsingStatsApi()];
                                    case 4:
                                        if (t = r.sent(), !(Object.keys(t).length > 0)) return [3, 7];
                                        for ("function" == typeof this.reportMigratedLoveDataBiEvent && this.reportMigratedLoveDataBiEvent({
                                                galleryId: this.galleryId,
                                                migrationStatus: "start"
                                            }), o = [], n = 0, i = Object.entries(t); n < i.length; n++) a = i[n], c = a[0], l = a[1], o.push(g.mergeDataFromStatsToReactionService(c, l, this.instance, this.baseUrl, this.galleryId, this.appDefinitionId));
                                        return [4, Promise.all(o)];
                                    case 5:
                                        return p = r.sent(), [4, g.getItemsLoveData(this.items, this.instance, this.baseUrl, this.galleryId, this.appDefinitionId)];
                                    case 6:
                                        e = r.sent(), s.G.isSubset(t, e) ? "function" == typeof this.reportMigratedLoveDataBiEvent && this.reportMigratedLoveDataBiEvent({
                                            galleryId: this.galleryId,
                                            migrationStatus: "success"
                                        }) : "function" == typeof this.sentryReport && ((h = p.findIndex((function(e) {
                                            return "200" !== e.status.toString()
                                        }))) > -1 ? (u = "Reaction-Service error - migrating data failed - ".concat(p[h].status, " : ").concat(p[h].message), this.sentryReport(u)) : (u = "Reaction-Service error - loveCountsReactionService !== loveCountsStatsApi", this.sentryReport(u))), r.label = 7;
                                    case 7:
                                        return [3, 9];
                                    case 8:
                                        return r.sent(), "function" == typeof this.sentryReport && (u = "Reaction-Service error - Migration general error", this.sentryReport(u)), [3, 9];
                                    case 9:
                                        return [2]
                                }
                            }))
                        }))
                    }, e.prototype.getLoveDataUsingStatsApi = function() {
                        return (0, r.mG)(this, void 0, void 0, (function() {
                            var e, t, o;
                            return (0, r.Jh)(this, (function(r) {
                                switch (r.label) {
                                    case 0:
                                        e = "", r.label = 1;
                                    case 1:
                                        return r.trys.push([1, 6, , 7]), (e = this.config.instanceId || l.Z.instanceId) ? [3, 2] : (console.warn("cannot report love counter - no instance id"), [2]);
                                    case 2:
                                        return [4, fetch("".concat(this.baseUrl, "/_api/pro-gallery-webapp/v1/gallery/").concat(this.galleryId, "/").concat(e, "/stats"))];
                                    case 3:
                                        return [4, (t = r.sent()).json()];
                                    case 4:
                                        return (t = r.sent()) && t.photoId2Love ? [2, t.photoId2Love] : [2];
                                    case 5:
                                        return [3, 7];
                                    case 6:
                                        return o = r.sent(), console.error("Failed getting love counts", o), [3, 7];
                                    case 7:
                                        return [2]
                                }
                            }))
                        }))
                    }, e.prototype.getLoveDataWithOriginalFunction = function() {
                        var e, t = this;
                        try {
                            e = this.config.instanceId || l.Z.instanceId
                        } catch (t) {
                            e = ""
                        }
                        e ? fetch("".concat(this.baseUrl, "/_api/pro-gallery-webapp/v1/gallery/").concat(this.galleryId, "/").concat(e, "/stats")).then((function(e) {
                            return e.json()
                        })).then((function(e) {
                            try {
                                e && e.photoId2Love && (t.loveCounts = e.photoId2Love, t.onLoveCountsFetched && t.onLoveCountsFetched(t.loveCounts))
                            } catch (e) {
                                console.error("Failed getting love counts", e)
                            }
                        })) : console.warn("cannot report love counter - no instance id")
                    }, e.prototype.getLoveCount = function(e) {
                        return Math.max(0, this.loveCounts[e]) || 0
                    }, e.prototype.html2img = function(e, t) {
                        o.e(5).then(o.t.bind(o, 7907, 23)).then((function(o) {
                            try {
                                var r = l.Z.document.createElement("div");
                                r.innerHTML = e.html, r.style.boxSizing = "border-box", r.style.background = e.style.bgColor, r.style.position = "absolute", r.style.top = 0, r.style.left = 0, r.style.zIndex = -1, r.className = "text-item", l.Z.document.body.appendChild(r), o(r).then((function(e) {
                                    r.remove();
                                    var o = e.toDataURL();
                                    "function" == typeof t && t(o)
                                }))
                            } catch (e) {
                                "function" == typeof t && t("")
                            }
                        }))
                    }, e.prototype.share = function(e, t, o) {
                        s.G.isDemo() || (o && (t.numOfItems = o), this.shareImp(e, t))
                    }, e.prototype.downloadTextItem = function(e) {
                        this.html2img(e, (function(e) {
                            try {
                                e = e.replace(/^data:image\/[^;]/, "data:application/octet-stream"), l.Z.open(e)
                            } catch (e) {}
                        }))
                    }, e.prototype.getReachLevel = function(e) {
                        var t, o = Number(e || 0);
                        if (i().isUndefined(this.reachLevel)) {
                            var r = s.G.getLocalStorage();
                            t = Number(r["".concat(this.siteUrl, "|reach-level")] || 0) + o
                        } else t = this.reachLevel + o;
                        return t
                    }, e.prototype.setReachLevel = function(e) {
                        e > 0 || (e = 0);
                        try {
                            var t = this.getReachLevel(0);
                            if (e > 0 && 0 === t && i().isUndefined(this.reachLevel)) s.G.getLocalStorage()["".concat(this.siteUrl, "|reach-level")] = e, this.reachLevel = e
                        } catch (e) {
                            console.warn("set reach level error", e)
                        }
                    }, e.prototype.getShareUrl = function(e) {
                        var t = this.shouldUseGalleryIdForShareUrl ? this.galleryId + "_" : this.compId.replace("comp-", "") + "-";
                        return this.pageUrl + "?pgid=" + t + this.getItemId(e)
                    }, e.prototype.getItemId = function(e) {
                        return e.id || e.photoId || e.itemId
                    }, e.prototype.shareImp = function(e, t, o) {
                        var r = {
                                id: this.getItemId(t),
                                idx: t.idx || 0,
                                url: t.createUrl && t.createUrl("sample", "img"),
                                title: t.title || t.description || this.siteInfo.siteTitle,
                                hashtag: t.hashtag
                            },
                            n = encodeURIComponent(this.getShareUrl(r)),
                            a = encodeURIComponent(r.title || ""),
                            c = encodeURIComponent(r.url),
                            p = encodeURIComponent(this.siteInfo.siteKeywords),
                            h = encodeURIComponent("".concat(this.getShareUrl(r)));
                        switch (i().isFunction(o) || (o = function(e, t) {
                            try {
                                if (s.G.isiOS() && "Email" === t) l.Z.location.href = e;
                                else {
                                    var o = l.Z.open(e, t + " Share", "height=640,width=960,toolbar=no,menubar=no,scrollbars=no,location=no,status=no");
                                    setTimeout((function() {
                                        try {
                                            "Email" === t && o.location.hasOwnProperty("pathname") && "blank" === o.location.pathname && o.close()
                                        } catch (e) {
                                            console.warn("Could not close mailto window")
                                        }
                                    }), 5e3)
                                }
                            } catch (e) {}
                        }), e) {
                            case "facebook":
                                o("http://www.facebook.com/sharer/sharer.php?u=" + n + "&t=" + a, "Facebook");
                                break;
                            case "twitter":
                                var u = "&amp;text=" + ("undefined" === a ? "" : a);
                                if (u.length > 110) u = u.slice(0, 107) + "...";
                                else {
                                    var d = "&amp;hashtags=" + p;
                                    (u + d).length <= 110 && (u += d)
                                }
                                o("https://twitter.com/intent/tweet?url=" + n + u, "Twitter");
                                break;
                            case "pinterest":
                                o("https://pinterest.com/pin/create/button/?url=" + n + "&media=" + c.replace("webp", "jpg") + "&description=" + a, "Pinterest");
                                break;
                            case "google":
                                o("https://plus.google.com/share?url=" + n, "Google Plus");
                                break;
                            case "tumblr":
                                o("http://www.tumblr.com/share/link?url=" + n, "Tumblr");
                                break;
                            case "email":
                                o("mailto:?Subject=" + a + "&body=" + h, "Email");
                                break;
                            case "copylink":
                                ! function(e) {
                                    var t = document.createElement("textarea");
                                    t.value = e, t.setAttribute("readonly", ""), t.style.position = "absolute", t.style.left = "-9999px", document.body.appendChild(t);
                                    var o = document.getSelection().rangeCount > 0 && document.getSelection().getRangeAt(0);
                                    t.select(), document.execCommand("copy"), document.body.removeChild(t), o && (document.getSelection().removeAllRanges(), document.getSelection().addRange(o))
                                }(this.getShareUrl(r))
                        }
                    }, e.prototype.reportLoveToStats = function(e, t) {
                        try {
                            if (!this.statsProps || !this.statsProps.instance_id) return void this.getStats();
                            var o = i().merge(this.statsProps, {
                                    photo_id: e
                                }),
                                r = this.statsToken || l.Z.statsToken,
                                n = s.G.generateUUID();
                            fetch(l.Z.location.protocol + "//photographers-counters.wix.com/collector/rest/collect-js?ctToken=" + r, {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json"
                                },
                                body: JSON.stringify({
                                    messageId: n,
                                    metrics: [{
                                        type: "photo",
                                        reportMetrics: [{
                                            name: "love",
                                            value: String(t)
                                        }],
                                        properties: o
                                    }]
                                })
                            }).then((function(e) {
                                console.log("Success report love", e)
                            }))
                        } catch (e) {
                            console.error("Error reporting love to stats", e)
                        }
                    }, e.prototype.getLoveStorageKey = function(e) {
                        return "pro-gallery-item-love-" + e
                    }, e.prototype.isLoved = function(e) {
                        if (g.shouldUseReactionService()) {
                            var t = g.isLovedByCurrentVisitor(e, this.visitorId, this.reactionsServiceResponse),
                                o = s.G.getLocalStorage()[this.getLoveStorageKey(e)];
                            return t || o
                        }
                        try {
                            return void 0 !== s.G.getLocalStorage() && (!!s.G.getLocalStorage()[this.getLoveStorageKey(e)] || !1)
                        } catch (e) {
                            console.warn("isLoved failed", e)
                        }
                    }, e.prototype.toggleLove = function(e, t) {
                        try {
                            var o = this.isLoved(e) ? "DELETE" : "PUT";
                            g.toggleItemLove(e, o, this.instance, this.baseUrl, this.galleryId, this.appDefinitionId)
                        } catch (t) {
                            if (s.G.isVerbose() && console.warn("Reaction service toggleLove failed", t), "function" == typeof this.sentryReport) {
                                var r = "Reaction Service error - couldn't toggle love data in gallery: ".concat(this.galleryId, " item: ").concat(e);
                                this.sentryReport(r)
                            }
                        }
                        if (!this.isRemoveUseOfCounterApiEnabled) try {
                            if (!s.G.getLocalStorage()) return !1;
                            var n = void 0;
                            this.isLoved(e) && !0 !== t || !1 === t ? (s.G.getLocalStorage()[this.getLoveStorageKey(e)] = "", n = -1) : (s.G.getLocalStorage()[this.getLoveStorageKey(e)] = !0, n = 1), this.reportLoveToStats(e, n)
                        } catch (e) {
                            console.warn("toggleLove failed", e)
                        }
                    }, e.prototype.isFirstLoveClick = function(e) {
                        try {
                            return void 0 === s.G.getLocalStorage()[this.getLoveStorageKey(e)]
                        } catch (e) {
                            console.warn("isFirstLoveClick failed", e)
                        }
                    }, e.prototype.postLoveActivity = function(e) {
                        var t = this.getItemId(e);
                        this.isFirstLoveClick(t) && function(e) {
                            try {
                                var t = {
                                    type: a.Z.Activities.Type.SOCIAL_TRACK,
                                    info: {
                                        type: e.activityType,
                                        channel: e.activityNetwork,
                                        itemInfo: {
                                            itemUrl: e.url,
                                            itemId: e.id,
                                            itemType: e.type.toUpperCase()
                                        }
                                    },
                                    details: {
                                        additionalInfoUrl: e.url,
                                        summary: ""
                                    },
                                    contactUpdate: null
                                };
                                a.Z.Activities.postActivity(t, (function(e) {
                                    console.log("Activity ID: " + e.activityId + ", Contact ID: " + e.contactId)
                                }), (function(e) {
                                    console.log("Failure message:", e)
                                }))
                            } catch (e) {
                                console.log("error posting activity.", e)
                            }
                        }({
                            activityType: "LOVE",
                            activityNetwork: "SITE",
                            id: t,
                            url: this.getShareUrl(e),
                            type: e.type
                        })
                    }, e.prototype.showTooltip = function(e, t, o) {
                        if (!(document.getElementsByClassName("pro-tooltip").length >= 1)) {
                            var r = e.currentTarget;
                            if (r) {
                                var n, i, s = r.getBoundingClientRect(),
                                    a = s.top,
                                    p = s.left;
                                try {
                                    i = l.Z.innerWidth
                                } catch (e) {
                                    i = 980
                                }
                                switch (void 0 === o && (o = p > i / 2 ? "right" : "left"), o) {
                                    case "top":
                                        n = {
                                            top: a - 30 + "px",
                                            left: p + 28 + "px",
                                            opacity: 1
                                        };
                                        break;
                                    case "right":
                                        n = {
                                            top: a - 4 + "px",
                                            left: p - 20 + "px",
                                            opacity: 1
                                        };
                                        break;
                                    default:
                                        n = {
                                            top: a - 4 + "px",
                                            left: p + 40 + "px",
                                            opacity: 1
                                        }
                                }
                                n["pointer-events"] = "none";
                                var h = l.Z.document.createElement("div");
                                h.classList.add("pro-tooltip"), h.classList.add(o), Object.assign(h.style, n), h.innerHTML = c.Z.getByKey(t), l.Z.document.body.appendChild(h)
                            }
                        }
                    }, e.prototype.hideTooltip = function() {
                        l.Z.document.body.removeChild(document.getElementsByClassName("pro-tooltip")[0])
                    }, e.prototype.toggleTooltip = function(e, t, o) {
                        1 === document.getElementsByClassName("pro-tooltip").length ? this.hideTooltip() : this.showTooltip(e, t, o)
                    }, e.prototype.viewClassName = function(e, t) {
                        return "fullscreen" === e && "desktop" === t ? "fullscreen-icon" : ""
                    }, e
                }();
            const f = y;
            var m = new y
        }
    }
]);
//# sourceMappingURL=ItemActions.chunk.min.js.map